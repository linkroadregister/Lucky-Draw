<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
<<<<<<< HEAD
  <title>Lucky Draw ‚Äî 6 Digits</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="header hide-in-fs">
    <div class="title">Lucky Draw</div>
    <nav class="nav">
      <button id="tabRegister" class="btn btn-ghost" aria-controls="panelRegister">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
      <button id="tabDraw" class="btn btn-primary" aria-controls="panelDraw">‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</button>
      <button id="btnFullscreen" class="btn btn-ghost" title="‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ (F)">‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ ‚§¢</button>
    </nav>
  </header>

  <main>
    <!-- Draw panel -->
    <section id="panelDraw" class="center">
      <div id="drawStage" class="stage stack" tabindex="-1" aria-live="polite">
        <div id="digitsRow" class="digits" aria-label="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏∏‡πà‡∏°">
=======
  <title>Lucky Draw ‚Äì Standalone (No CDN)</title>
  <style>
    :root{--gold:#ffd166;--bg1:#b2070b;--bg2:#6c0404;--text:#111827}
    *{box-sizing:border-box} html,body{height:100%} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans Thai',sans-serif;color:#fff;
      background:
        radial-gradient(circle at 50% 40%, rgba(255,255,255,.07), rgba(255,255,255,0) 36%),
        repeating-conic-gradient(from 0deg, rgba(255,255,255,.08) 0 10deg, rgba(0,0,0,0) 10deg 20deg),
        radial-gradient(circle at 50% 40%, var(--bg1) 0%, #8d0606 60%, var(--bg2) 100%);
      background-blend-mode: screen, soft-light, normal; min-height:100vh; display:flex; flex-direction:column}
    header{display:flex;gap:.75rem;align-items:center;justify-content:space-between;padding:1rem 1.25rem}
    .title{background:#fff;color:var(--text);padding:.5rem 1rem;border-radius:14px;font-weight:900;box-shadow:0 6px 16px rgba(0,0,0,.2)}
    .nav{display:flex;gap:.5rem;flex-wrap:wrap}
    button{cursor:pointer;border-radius:10px;border:1px solid transparent;padding:.6rem 1rem;font-weight:700}
    .btn-primary{background:#fff;color:#7a0303}
    .btn-ghost{background:transparent;border-color:#ffffff40;color:#fff}
    .btn{transition:transform .06s ease, box-shadow .2s} .btn:active{transform:translateY(1px)}
    main{flex:1;padding:0 1.25rem 2rem}
    .center{display:grid;place-items:center}
    .stack{display:grid;gap:1rem}
    .digits{display:flex;justify-content:center;gap:min(2vw,18px);flex-wrap:wrap}
    .digit{width:clamp(60px,9vw,110px);height:clamp(86px,14vw,140px);background:#fff;color:var(--text);border-radius:16px;display:grid;place-items:center;font-weight:900;font-size:clamp(36px,7vw,80px);box-shadow:0 10px 22px rgba(0,0,0,.25), inset 0 -4px 0 #f2f2f2;border:4px solid #f6e1a2}
    .digit.locked{outline:3px solid var(--gold);box-shadow:0 0 0 3px rgba(255,209,102,.35),0 10px 22px rgba(0,0,0,.25)}
    .row{display:flex;gap:.5rem;align-items:center;justify-content:center;flex-wrap:wrap}
    select,input,textarea{padding:.55rem .75rem;border-radius:10px;border:1px solid #e5e7eb;color:var(--text)}
    .panel{background:rgba(255,255,255,.1);border-radius:16px;padding:1rem}
    table{width:100%;border-collapse:collapse;overflow:hidden;border-radius:12px}
    thead th{background:rgba(255,255,255,.2);text-align:left;padding:.5rem}
    tbody td{padding:.5rem;border-top:1px solid rgba(255,255,255,.15)}
    .muted{opacity:.85}
    .hidden{display:none !important}
    /* modal */
    .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:50}
    .modal-bg.show{display:flex}
    .modal{background:#7a0202;color:#fff;width:min(92vw,900px);border-radius:16px;padding:1rem}
    .list{max-height:45vh;overflow:auto}
    /* fullscreen */
    .fs-mode .hide-in-fs{display:none !important}
    .fs-mode .show-in-fs{display:block !important}
    .show-in-fs{display:none}
    .fs-mode main{padding:0}
    .fs-mode #digitsRow{gap:clamp(10px,2.5vw,28px)}
    .fs-mode .digit{width:clamp(110px,14vw,220px);height:clamp(150px,20vw,260px);font-size:clamp(72px,12vw,180px);border-width:6px}
    .fs-mode #fsPrizeRemain{display:none}
    .fs-mode .modal-bg{display:none!important}
  </style>
</head>
<body>
  <header class="hide-in-fs">
    <div class="title">Lucky Draw</div>
    <div class="nav">
      <button id="tabRegister" class="btn btn-ghost">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
      <button id="tabDraw" class="btn btn-primary">‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</button>
      <button id="btnFullscreen" class="btn btn-ghost">‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ ‚§¢</button>
    </div>
  </header>

  <main>
    <!-- DRAW -->
    <section id="panelDraw" class="center">
      <div id="drawStage" class="stack" style="max-width:1100px;width:100%">
        <div id="digitsRow" class="digits">
>>>>>>> parent of 9161dd6 (v.1)
          <div class="digit" id="d0">0</div><div class="digit" id="d1">0</div><div class="digit" id="d2">0</div>
          <div class="digit" id="d3">0</div><div class="digit" id="d4">0</div><div class="digit" id="d5">0</div>
        </div>

        <div class="row hide-in-fs">
<<<<<<< HEAD
          <label for="quickPrize">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</label>
          <select id="quickPrize" class="select" aria-label="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•"></select>
          <div class="muted">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="quickRemain">-</span></div>
        </div>
        <div id="fsPrizeView" class="show-in-fs fsPrize" aria-hidden="true">
          ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: <span id="fsPrizeName" class="gold"></span> <span id="fsPrizeRemain" class="muted"></span>
        </div>

        <div id="drawNumberLine" class="hide-in-fs drawLine">
          ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ: <span id="drawNumber" class="gold bold">000000</span>
        </div>
=======
          <div>‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</div>
          <select id="quickPrize" style="min-width:280px;background:#fff;font-weight:700"></select>
          <div class="muted">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <span id="quickRemain">-</span></div>
        </div>
        <div id="fsPrizeView" class="show-in-fs" style="text-align:center;font-size:1.25rem;font-weight:700">
          ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: <span id="fsPrizeName" style="color:var(--gold)"></span> <span id="fsPrizeRemain" class="muted" style="font-size:.95rem"></span>
        </div>

        <div id="drawNumberLine" class="hide-in-fs" style="text-align:center;font-size:1.25rem">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ: <span id="drawNumber" style="color:var(--gold);font-weight:900">000000</span></div>
>>>>>>> parent of 9161dd6 (v.1)

        <div class="row hide-in-fs">
          <button id="btnStart" class="btn btn-primary">üé∞ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏∏‡πà‡∏°</button>
          <button id="btnManagePrize" class="btn btn-ghost">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</button>
          <button id="btnResetWinners" class="btn btn-ghost">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞</button>
          <button id="btnExportWinners" class="btn btn-ghost">Export ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞ CSV</button>
        </div>

<<<<<<< HEAD
        <div class="panel hide-in-fs winnersBox">
          <h3>‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞</h3>
          <ol id="winnerList" class="list grid-gap"></ol>
=======
        <div class="hide-in-fs panel" style="max-width:900px;margin:0 auto">
          <h3 style="margin:0 0 .5rem 0">‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞</h3>
          <ol id="winnerList" class="list" style="display:grid;gap:.5rem"></ol>
>>>>>>> parent of 9161dd6 (v.1)
        </div>
      </div>
    </section>

<<<<<<< HEAD
    <!-- Register panel -->
    <section id="panelRegister" class="hidden" aria-hidden="true">
      <div class="panel registerBox">
        <div class="tabRow">
          <button id="tabNamesList" class="btn btn-primary">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
          <button id="tabNamesAdd" class="btn btn-ghost">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
        </div>

        <div id="namesAdd" class="hidden addBox">
          <div class="addGrid">
            <input id="regNumber" maxlength="6" inputmode="numeric" placeholder="000000" aria-label="‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å"/>
            <input id="regName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏•‡∏∏‡πâ‡∏ô" aria-label="‡∏ä‡∏∑‡πà‡∏≠"/>
            <button id="btnAdd" class="btn solid-gold">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
          </div>
          <div class="toolsRow">
            <input type="file" id="fileImport" accept=".csv,.txt" class="hidden" />
            <button id="btnImport" class="btn btn-ghost">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå</button>
            <button id="btnExport" class="btn btn-ghost">Export ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ CSV</button>
            <button id="btnClearAll" class="btn btn-ghost">‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          </div>
          <p class="muted small">‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤: ‡∏ï‡πà‡∏≠‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô <b>‡πÄ‡∏•‡∏Ç,‡∏ä‡∏∑‡πà‡∏≠</b> ‡∏´‡∏£‡∏∑‡∏≠ <b>‡πÄ‡∏•‡∏Ç</b> ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
        </div>

        <div id="namesList" class="stack">
          <div class="searchRow">
            <input id="searchBox" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç" class="search" />
            <span class="muted">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <b id="countAll">0</b> ‡∏£‡∏≤‡∏¢</span>
          </div>
          <table class="table" role="table">
            <thead><tr><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th class="centerCell">‡∏•‡∏ö</th></tr></thead>
            <tbody id="regTable"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Result Modal -->
  <div id="resultModal" class="modal-bg" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="resTitle">
      <h3 id="resTitle" class="modalTitle">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°</h3>
      <p class="muted">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å: <span id="resNumber" class="gold bold">000000</span></p>
      <div id="resFound" class="hidden">
        <p>‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞: <span id="resName" class="bold"></span></p>
        <p class="muted">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: <span id="resPrize" class="bold"></span></p>
      </div>
      <div id="resEmpty" class="hidden"><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</p></div>
      <div class="row end mt">
        <button id="btnClose" class="btn btn-ghost">‡∏õ‡∏¥‡∏î</button>
        <button id="btnConfirmWin" class="btn solid-gold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞</button>
      </div>
    </div>
  </div>

  <!-- Prize Modal -->
  <div id="prizeModal" class="modal-bg" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="prizeTitle">
      <h3 id="prizeTitle" class="modalTitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>
      <div id="prizeRows" class="stack"></div>
      <div class="toolsRow">
        <input id="newPrizeName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡∏°‡πà" class="flex1"/>
        <input id="newPrizeQty" type="number" min="1" value="1" class="numSmall"/>
        <button id="addPrize" class="btn solid-gold">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
      </div>
      <div class="row end mt">
        <button id="closePrize" class="btn btn-ghost">‡∏õ‡∏¥‡∏î</button>
        <button id="savePrize" class="btn solid-gold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
=======
    <!-- REGISTER -->
    <section id="panelRegister" class="hidden">
      <div class="panel" style="max-width:1100px;margin:0 auto;display:grid;gap:1rem">
        <div style="display:flex;gap:.5rem">
          <button id="tabNamesList" class="btn btn-primary">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
          <button id="tabNamesAdd" class="btn btn-ghost">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
        </div>
        <div id="namesAdd" class="hidden" style="display:grid;gap:.8rem">
          <div style="display:grid;grid-template-columns:160px 1fr auto;gap:.6rem;align-items:center">
            <input id="regNumber" maxlength="6" placeholder="000000" />
            <input id="regName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡∏•‡∏∏‡πâ‡∏ô" />
            <button id="btnAdd" class="btn" style="background:var(--gold);color:#111;font-weight:700">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
          </div>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap;align-items:center">
            <input type="file" id="fileImport" accept=".csv,.txt" class="hidden" />
            <button id="btnImport" class="btn btn-ghost">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå</button>
            <button id="btnExport" class="btn btn-ghost">Export ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ CSV</button>
            <button id="btnClearAll" class="btn btn-ghost">‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          </div>
          <p class="muted" style="font-size:.9rem">‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤: ‡∏ï‡πà‡∏≠‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô <b>‡πÄ‡∏•‡∏Ç,‡∏ä‡∏∑‡πà‡∏≠</b> ‡∏´‡∏£‡∏∑‡∏≠ <b>‡πÄ‡∏•‡∏Ç</b> ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
        </div>
        <div id="namesList" class="stack">
          <div style="display:flex;gap:.5rem;align-items:center;justify-content:space-between;flex-wrap:wrap">
            <input id="searchBox" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç" style="max-width:360px;width:100%"/>
            <span class="muted">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <b id="countAll">0</b> ‡∏£‡∏≤‡∏¢</span>
          </div>
          <table>
            <thead><tr><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th style="text-align:center">‡∏•‡∏ö</th></tr></thead>
            <tbody id="regTable"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- RESULT MODAL -->
  <div id="resultModal" class="modal-bg">
    <div class="modal">
      <h3 style="margin:0;font-size:1.1rem;font-weight:800">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°</h3>
      <p class="muted">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å: <span id="resNumber" style="color:var(--gold);font-weight:900">000000</span></p>
      <div id="resFound" class="hidden">
        <p>‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞: <span id="resName" style="font-weight:800"></span></p>
        <p class="muted">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: <span id="resPrize" style="font-weight:700"></span></p>
      </div>
      <div id="resEmpty" class="hidden"><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</p></div>
      <div class="row" style="justify-content:flex-end;margin-top:1rem">
        <button id="btnClose" class="btn btn-ghost">‡∏õ‡∏¥‡∏î</button>
        <button id="btnConfirmWin" class="btn" style="background:var(--gold);color:#111;font-weight:700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞</button>
      </div>
    </div>
  </div>

  <!-- PRIZE MODAL -->
  <div id="prizeModal" class="modal-bg">
    <div class="modal">
      <h3 style="margin:0;font-size:1.1rem;font-weight:800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>
      <div id="prizeRows" class="stack" style="margin-top:.8rem"></div>
      <div style="display:flex;gap:.5rem;margin-top:.5rem;flex-wrap:wrap">
        <input id="newPrizeName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡∏°‡πà" style="flex:1;min-width:220px"/>
        <input id="newPrizeQty" type="number" min="1" value="1" style="width:90px"/>
        <button id="addPrize" class="btn" style="background:var(--gold);color:#111;font-weight:700">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
      </div>
      <div class="row" style="justify-content:flex-end;margin-top:1rem">
        <button id="closePrize" class="btn btn-ghost">‡∏õ‡∏¥‡∏î</button>
        <button id="savePrize" class="btn" style="background:var(--gold);color:#111;font-weight:700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </div>
  </div>

  <script>
    // === State ===
    const SKEY='ldraw-6digits-standalone.v1';
    const state={participants:[], winners:[], shuffleMs:1200, prizes:[{name:'‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ',qty:1,active:true}]};
    try{Object.assign(state,JSON.parse(localStorage.getItem(SKEY)||'{}'))}catch{}
    const $=id=>document.getElementById(id);
    const onlyDigits=s=>{let out='';const str=String(s);for(let i=0;i<str.length;i++){const c=str[i];if(c>='0'&&c<='9') out+=c;}return out};
    const pad6=n=>onlyDigits(n).padStart(6,'0').slice(-6);
    const save=()=>localStorage.setItem(SKEY,JSON.stringify(state));

    // Tabs
    const show=p=>{ $('panelDraw').classList.toggle('hidden',p!=='draw'); $('panelRegister').classList.toggle('hidden',p!=='register');
      $('tabDraw').classList.toggle('btn-primary',p==='draw'); $('tabRegister').classList.toggle('btn-primary',p==='register');
      $('tabDraw').classList.toggle('btn-ghost',p!=='draw'); $('tabRegister').classList.toggle('btn-ghost',p!=='register'); };
    $('tabDraw').onclick=()=>show('draw'); $('tabRegister').onclick=()=>show('register');

    // Names sub-tabs
    function showNamesTab(k){ const add=$('namesAdd'), list=$('namesList'); if(k==='add'){ add.classList.remove('hidden'); list.classList.add('hidden'); $('tabNamesAdd').classList.add('btn-primary'); $('tabNamesAdd').classList.remove('btn-ghost'); $('tabNamesList').classList.add('btn-ghost'); $('tabNamesList').classList.remove('btn-primary'); } else { list.classList.remove('hidden'); add.classList.add('hidden'); $('tabNamesList').classList.add('btn-primary'); $('tabNamesList').classList.remove('btn-ghost'); $('tabNamesAdd').classList.add('btn-ghost'); $('tabNamesAdd').classList.remove('btn-primary'); } }
    $('tabNamesList').onclick=()=>showNamesTab('list'); $('tabNamesAdd').onclick=()=>showNamesTab('add');

    // Register rendering/search
    let searchQuery='';
    function renderReg(){
      const tb=$('regTable'); tb.innerHTML='';
      const data=state.participants.filter(p=>!searchQuery||p.name.toLowerCase().includes(searchQuery)||p.num.includes(searchQuery));
      $('countAll').textContent=state.participants.length;
      data.forEach((p)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${p.num}</td><td>${p.name||'-'}</td><td style="text-align:center"><button data-num="${p.num}" class="btn btn-ghost" style="padding:.25rem .5rem">‡∏•‡∏ö</button></td>`;
        tb.appendChild(tr);
      });
      tb.querySelectorAll('button[data-num]').forEach(b=>b.onclick=e=>{
        const num=e.target.dataset.num; const idx=state.participants.findIndex(x=>x.num===num);
        if(idx>-1){ state.participants.splice(idx,1); save(); renderReg(); }
      });
    }
    $('searchBox').addEventListener('input',e=>{searchQuery=(e.target.value||'').trim().toLowerCase(); renderReg();});

    const genUniqueNumber=()=>{let tries=0;while(tries++<800){const n=String(Math.floor(Math.random()*1e6)).padStart(6,'0');if(!state.participants.some(p=>p.num===n))return n;}return String(Date.now()%1e6).padStart(6,'0')};
    $('regNumber').addEventListener('input',e=>e.target.value=pad6(e.target.value));
    $('btnAdd').onclick=()=>{
      const num=pad6($('regNumber').value),name=$('regName').value.trim();
      if(!num){$('regNumber').focus();return}
      if(state.participants.some(p=>p.num===num)){alert('‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß');return}
      state.participants.push({num,name}); $('regNumber').value=''; $('regName').value=''; save(); renderReg(); showNamesTab('list');
    };

    // Import/Export/clear participants
    $('btnImport').onclick=()=>$('fileImport').click();
    $('fileImport').addEventListener('change',async e=>{const f=e.target.files[0]; if(!f) return; const txt=await f.text(); importParticipants(txt); e.target.value='';});
    function importParticipants(text){
      const used=new Set(state.participants.map(p=>p.num));
      const lines=text.split(/\\r?\\n/).map(x=>x.trim()).filter(Boolean); let added=0;
      for(const line of lines){
        const parts=line.split(',');
        const num=pad6(parts[0]||'');
        if(!num||used.has(num)) continue;
        used.add(num);
        state.participants.push({num,name:(parts[1]||'').trim()});
        added++;
      }
      save(); renderReg(); alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢: ${added} ‡∏£‡∏≤‡∏¢`);
    }
    $('btnExport').onclick=()=>{
      const rows=[["number","name"],...state.participants.map(p=>[p.num,p.name])];
      const csv=rows.map(r=>r.map(x=>'"'+String(x).replace(/"/g,'""')+'"').join(',')).join('\\n');
      const url=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
      const a=document.createElement('a'); a.href=url; a.download='participants.csv'; a.click(); URL.revokeObjectURL(url);
    };
    $('btnClearAll').onclick=()=>{if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')){state.participants=[]; save(); renderReg();}};

    // Export winners
    $('btnExportWinners').onclick=()=>{
      const rows=[["number","name","prize","timestamp"],...state.winners.map(w=>[w.num,w.name,w.prize,w.ts])];
      const csv=rows.map(r=>r.map(x=>'"'+String(x).replace(/"/g,'""')+'"').join(',')).join('\\n');
      const url=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
      const a=document.createElement('a'); a.href=url; a.download='winners.csv'; a.click(); URL.revokeObjectURL(url);
    };

    // Dummy seed (only first time)
    const dummyNames=['David Wilson','Jane Smith','John Doe','Michael Johnson','Sarah Brown','Emily Davis','Chris Miller','Olivia Taylor','Daniel Anderson','Sophia Thomas','‡∏ö‡∏¥‡∏ô‡πÄ‡∏î‡∏ä ‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á','‡∏õ‡∏ì‡∏¥‡∏ä‡∏≤ ‡πÄ‡∏Å‡πà‡∏á‡∏ô‡∏±‡∏Å','‡∏ß‡∏¥‡πÑ‡∏• ‡∏™‡∏ß‡∏¢‡πÉ‡∏™','‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ','‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡πÉ‡∏à‡∏á‡∏≤‡∏°','‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏û‡∏•‡∏±‡∏á‡∏î‡∏µ','‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏ô‡∏Å ‡∏®‡∏£‡∏µ‡∏™‡∏∏‡∏Ç','‡∏≠‡∏ò‡∏¥‡∏ä‡∏≤ ‡∏≠‡∏ô‡∏±‡∏ô‡∏ï‡πå‡∏ä‡∏±‡∏¢','‡∏ä‡∏≤‡∏ç‡∏ä‡∏±‡∏¢ ‡πÉ‡∏à‡∏Å‡∏•‡πâ‡∏≤','‡∏ß‡∏£‡∏£‡∏ì‡∏¥‡∏†‡∏≤ ‡∏û‡∏£‡∏´‡∏°‡∏™‡∏∏‡∏Ç'];
    function ensureDummy(){ if(state.participants.length===0){ const used=new Set(); dummyNames.forEach(n=>{ let num; do{ num=String(Math.floor(Math.random()*1e6)).padStart(6,'0'); }while(used.has(num)); used.add(num); state.participants.push({num,name:n}); }); save(); } }

    // Prizes helpers
    const activePrize=()=>state.prizes.find(p=>p.active)||state.prizes[0];
    const winsOfPrize=name=>state.winners.filter(w=>w.prize===name).length;
    const remain=p=>Math.max(0,(parseInt(p.qty||0)-winsOfPrize(p.name)));
    function updatePrizeViews(){ const p=activePrize(); const rem=p?`${remain(p)}/${p.qty}`:'-'; $('quickRemain').textContent=rem; $('fsPrizeName').textContent=p?p.name:'‚Äî'; $('fsPrizeRemain').textContent=p?`(‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${rem})`:''; }
    function buildQuickPrize(){ const sel=$('quickPrize'); sel.innerHTML=''; state.prizes.forEach((p,i)=>{ const opt=document.createElement('option'); opt.value=i; opt.textContent=`${p.name} (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${remain(p)}/${p.qty})`; if(p.active) opt.selected=true; sel.appendChild(opt); }); sel.onchange=()=>{ const i=parseInt(sel.value); state.prizes.forEach((p,idx)=>p.active=(idx===i)); save(); updatePrizeViews(); buildQuickPrize(); }; }

    // Digits utils
    function setDigits(s){for(let i=0;i<6;i++){ $('d'+i).textContent=s[i]||'0'; } $('drawNumber').textContent=s }
    function readDigits(){let s=''; for(let i=0;i<6;i++){ s+=($('d'+i).textContent||'0'); } return s }
    function pool(){const taken=new Set(state.winners.map(w=>w.num)); return state.participants.filter(p=>!taken.has(p.num)) }
    function clearLocks(){ for(let i=0;i<6;i++) $('d'+i).classList.remove('locked') }
    function revealTo(target, done){ let i=0; const lockNext=()=>{ if(i>=6){ done&&done(); return; } const box=$('d'+i); const final=target[i]; let t0=performance.now(); const dur=300; const tick=(now)=>{ if(now-t0>=dur){ box.textContent=final; box.classList.add('locked'); $('drawNumber').textContent=readDigits(); i++; setTimeout(lockNext,100); return; } box.textContent=String(Math.floor(Math.random()*10)); $('drawNumber').textContent=readDigits(); requestAnimationFrame(tick); }; requestAnimationFrame(tick); }; lockNext(); }

    // Draw
    let raf=0,final=null,person=null;
    $('btnStart').onclick=()=>{
      const p=pool(); if(!p.length){ $('resNumber').textContent='‚Äî‚Äî'; $('resFound').classList.add('hidden'); $('btnConfirmWin').classList.add('hidden'); $('resEmpty').classList.remove('hidden'); $('resultModal').classList.add('show'); return; }
      const ap=activePrize(); if(!ap){ alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•'); return; }
      if(remain(ap)<=0){ alert('‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•'); return; }
      const pick=p[Math.floor(Math.random()*p.length)]; final=pick.num; person=pick; clearLocks();
      const start=performance.now();
      const spinStep=(now)=>{
        if(now-start>=state.shuffleMs){
          cancelAnimationFrame(raf);
          revealTo(final, ()=>{
            const isFS = document.body.classList.contains('fs-mode');
            if(isFS){
              const ts=new Date().toLocaleString('th-TH',{hour12:false});
              state.winners.unshift({num:person.num,name:person.name,prize:ap.name,ts});
              save(); paintWinners(); updatePrizeViews(); buildQuickPrize();
            }else{
              $('resNumber').textContent=final; $('resEmpty').classList.add('hidden'); $('resFound').classList.remove('hidden');
              $('resName').textContent=(person.name||'-')+' ('+person.num+')'; $('resPrize').textContent=ap.name;
              $('btnConfirmWin').classList.remove('hidden'); $('resultModal').classList.add('show');
            }
          });
          return;
        }
        if(((now-start)%80)<16){ setDigits(String(Math.floor(Math.random()*1e6)).padStart(6,'0')); }
        raf=requestAnimationFrame(spinStep);
      };
      raf=requestAnimationFrame(spinStep);
    };

    // Winners
    $('btnConfirmWin').onclick=()=>{ const ap=activePrize(); const ts=new Date().toLocaleString('th-TH',{hour12:false}); state.winners.unshift({num:person.num,name:person.name,prize:ap.name,ts}); save(); paintWinners(); updatePrizeViews(); buildQuickPrize(); $('btnClose').click() };
    function paintWinners(){ const box=$('winnerList'); box.innerHTML=''; state.winners.forEach(w=>{ const li=document.createElement('li'); li.style.cssText='background:rgba(255,255,255,.1);border-radius:10px;padding:.5rem'; li.innerHTML=`<div style="color:var(--gold);font-weight:800">${w.num}</div><div class="muted" style="font-size:.85rem">${w.name||'-'} ‚Ä¢ ${w.prize||''} ‚Ä¢ ${w.ts}</div>`; box.appendChild(li); }); }
    $('btnResetWinners').onclick=()=>{ if(confirm('‡∏•‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')){ state.winners=[]; save(); paintWinners(); updatePrizeViews(); buildQuickPrize(); }};

    // Prize modal
    const prizeModal=$('prizeModal');
    function openPrize(){ buildPrizeRows(); prizeModal.classList.add('show'); }
    function closePrize(){ prizeModal.classList.remove('show'); }
    $('btnManagePrize').onclick=openPrize; $('closePrize').onclick=closePrize; prizeModal.addEventListener('click',e=>{ if(e.target.id==='prizeModal') closePrize(); });
    function buildPrizeRows(){
      const wrap=$('prizeRows'); wrap.innerHTML='';
      state.prizes.forEach((p,i)=>{
        const row=document.createElement('div'); row.className='panel'; row.style.padding='.6rem'; row.style.display='grid'; row.style.gridTemplateColumns='1fr auto auto auto auto'; row.style.gap='.5rem'; row.style.alignItems='center';
        row.innerHTML=`<input data-i="${i}" class="pName" value="${p.name}">
          <span class="muted" style="font-size:.9rem">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: <b style="color:var(--gold)">${remain(p)}</b> / ${p.qty}</span>
          <input data-i="${i}" type="number" min="1" class="pQty" value="${p.qty}" style="width:80px">
          <label class="muted" style="display:flex;gap:.35rem;align-items:center"><input data-i="${i}" type="radio" name="activePrize" ${p.active?'checked':''}> ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
          <button data-i="${i}" class="del btn btn-ghost">‡∏•‡∏ö</button>`;
        wrap.appendChild(row);
      });
      wrap.querySelectorAll('.pName').forEach(inp=>inp.oninput=e=>{const i=+e.target.dataset.i; state.prizes[i].name=e.target.value; save(); updatePrizeViews(); buildQuickPrize();});
      wrap.querySelectorAll('.pQty').forEach(inp=>inp.oninput=e=>{const i=+e.target.dataset.i; state.prizes[i].qty=Math.max(1,parseInt(e.target.value||1)); save(); updatePrizeViews(); buildQuickPrize(); buildPrizeRows();});
      wrap.querySelectorAll('input[name=activePrize]').forEach((r,idx)=> r.onchange=()=>{ state.prizes.forEach((p,j)=>p.active=(j===idx)); save(); updatePrizeViews(); buildQuickPrize();});
      wrap.querySelectorAll('.del').forEach(btn=> btn.onclick=e=>{ const i=+e.target.dataset.i; if(state.prizes.length<=1){alert('‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•'); return} state.prizes.splice(i,1); save(); updatePrizeViews(); buildQuickPrize(); buildPrizeRows(); });
    }
    $('addPrize').onclick=()=>{ const name=$('newPrizeName').value.trim(); const qty=Math.max(1,parseInt($('newPrizeQty').value||1)); if(!name){$('newPrizeName').focus(); return} state.prizes.push({name,qty,active:false}); $('newPrizeName').value=''; $('newPrizeQty').value=1; save(); buildPrizeRows(); buildQuickPrize(); updatePrizeViews(); };
    $('savePrize').onclick=()=>{ save(); closePrize(); };

    // Modal base
    $('btnClose').onclick=()=>{$('resultModal').classList.remove('show')};
    $('resultModal').addEventListener('click',e=>{if(e.target.id==='resultModal')$('btnClose').click()});

    // Fullscreen
    function isFS(){return document.fullscreenElement||document.webkitFullscreenElement}
    function reqFS(el){(el.requestFullscreen||el.webkitRequestFullscreen||function(){}).call(el)}
    function exitFS(){(document.exitFullscreen||document.webkitExitFullscreen||function(){}).call(document)}
    function toggleFS(){const el=$('drawStage'); isFS()?exitFS():reqFS(el)}
    $('btnFullscreen').onclick=toggleFS; ['fullscreenchange','webkitfullscreenchange'].forEach(ev=>document.addEventListener(ev,()=>{document.body.classList.toggle('fs-mode',!!isFS()); updatePrizeViews();})); $('drawStage').addEventListener('dblclick',toggleFS);
    document.addEventListener('keydown',e=>{if(e.key==='f'||e.key==='F'){e.preventDefault();toggleFS();} if((e.key===' '||e.code==='Space')&&document.body.classList.contains('fs-mode')){e.preventDefault();$('btnStart').click();}});

    // Init
    function safeInit(){ try{
      ensureDummy(); renderReg(); paintWinners(); setDigits('000000'); show('draw'); buildQuickPrize(); updatePrizeViews(); showNamesTab('list');
    }catch(err){ alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö: '+err.message); console.error(err); } }
    // Run after DOM is ready (this script is at bottom but be safe)
    if(document.readyState === 'loading'){ document.addEventListener('DOMContentLoaded', safeInit); } else { safeInit(); }
  </script>
>>>>>>> parent of 9161dd6 (v.1)
</body>
</html>
